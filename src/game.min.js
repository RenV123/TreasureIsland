import{Grass}from"./GameObjects/grass.js";import{TreasureHunter}from"./GameObjects/treasureHunter.js";import{GameBoard}from"./gameBoard.js";import{DrawTypes}from"./GameObjects/gameObject.js";const canvas=document.getElementById("game-canvas"),context=canvas.getContext("2d");class Game{constructor(e,t,a,r=15,s=15,i=3,n=10){this.canvasWidth=t,this.canvasHeight=a,this._context=e,this._gameboard=new GameBoard(t,a,r,s,i,n),this.callbacks={keydown:this._keydown.bind(this)},this._treasureHunter=new TreasureHunter(this._gameboard,this._onTreasureCollected),this.bindEvents()}bindEvents=()=>{document.addEventListener("keydown",this.callbacks.keydown,!1)};unbindEvents=()=>{document.addEventListener("keydown",this.callbacks.keydown,!1)};_keydown=e=>{switch(e.preventDefault(),e.key){case"ArrowLeft":this._treasureHunter.moveLeft();break;case"ArrowRight":this._treasureHunter.moveRight();break;case"ArrowDown":this._treasureHunter.moveDown();break;case"ArrowUp":this._treasureHunter.moveUp();break}this._drawGame()};_drawGameObject=e=>{switch(this._context.fillStyle=e?.color??"pink",e.type){case DrawTypes.RECT:this._context.fillRect(e.x*e.width,e.y*e.height,e.width,e.height);break;case DrawTypes.CIRCLE:this._context.beginPath(),this._context.arc(e.x*e.width+e.width/2,e.y*e.height+e.height/2,e.width/2,0,2*Math.PI,!1),this._context.fill();break;case DrawTypes.IMG:break;default:}};_drawBoard=()=>{this._gameboard.tiles.length>0&&(this._context.fillStyle=(new Grass).color,this._context.fillRect(0,0,this.canvasWidth,this.canvasHeight),this._gameboard.tiles.forEach((e=>{e.forEach((e=>{"Grass"!==e.constructor.name&&this._drawGameObject(e)}))})))};_drawGame=()=>{this._drawBoard(),this._drawGameObject(this._treasureHunter)};_placeTreasureHunter=()=>{let e=this._gameboard.getRandomFreeSpotOnBoard();this._treasureHunter.x=e.x,this._treasureHunter.y=e.y,this._treasureHunter.width=e.width,this._treasureHunter.height=e.height};_onTreasureCollected=e=>{this._gameboard.collectTreasureTile(e)};startGame=()=>{this._placeTreasureHunter(),this._drawGame()}}const game=new Game(context,canvas.width,canvas.height);game.startGame();